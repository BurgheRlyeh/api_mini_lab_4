{"ast":null,"code":"import _slicedToArray from \"@babel/runtime/helpers/slicedToArray\";\nimport StyleSheet from \"react-native-web/dist/exports/StyleSheet\";\nimport TouchableOpacity from \"react-native-web/dist/exports/TouchableOpacity\";\nimport React, { useEffect, useState } from 'react';\nimport { Avatar, ListItem } from 'react-native-elements';\nimport { defaultPicURL } from \"../utils\";\nimport { collection, limit, onSnapshot, orderBy, query } from 'firebase/firestore';\nimport { db } from \"../firebase\";\n\nimport { jsx as _jsx } from \"react/jsx-runtime\";\nimport { jsxs as _jsxs } from \"react/jsx-runtime\";\nvar ChatListItem = function ChatListItem(_ref) {\n  var _lastMessage$data, _lastMessage$data2, _lastMessage$data3;\n  var id = _ref.id,\n    chatName = _ref.chatName,\n    enterChat = _ref.enterChat;\n  var _useState = useState({}),\n    _useState2 = _slicedToArray(_useState, 2),\n    lastMessage = _useState2[0],\n    setLastMessage = _useState2[1];\n  useEffect(function () {\n    var q = query(collection(db, \"chats\", id, \"messages\"), orderBy(\"timestamp\", \"desc\"), limit(1));\n    return onSnapshot(q, function (querySnapshots) {\n      var messages = [];\n      querySnapshots.forEach(function (doc) {\n        messages.push({\n          id: doc.id,\n          data: doc.data()\n        });\n      });\n      setLastMessage(messages[0]);\n      console.log(messages);\n    });\n  }, []);\n  return _jsx(TouchableOpacity, {\n    children: _jsxs(ListItem, {\n      onPress: function onPress() {\n        return enterChat(id, chatName);\n      },\n      bottomDivider: true,\n      children: [_jsx(Avatar, {\n        rounded: true,\n        source: {\n          uri: (lastMessage == null ? void 0 : (_lastMessage$data = lastMessage.data) == null ? void 0 : _lastMessage$data.photoUrl) || defaultPicURL\n        }\n      }), _jsxs(ListItem.Content, {\n        children: [_jsx(ListItem.Title, {\n          numberOfLines: 1,\n          style: {\n            fontWeight: \"800\"\n          },\n          children: chatName\n        }), _jsxs(ListItem.Subtitle, {\n          numberOfLines: 1,\n          ellipsizeMode: \"tail\",\n          children: [lastMessage == null ? void 0 : (_lastMessage$data2 = lastMessage.data) == null ? void 0 : _lastMessage$data2.displayName, \" : \", lastMessage == null ? void 0 : (_lastMessage$data3 = lastMessage.data) == null ? void 0 : _lastMessage$data3.message]\n        })]\n      })]\n    }, id)\n  });\n};\nexport default ChatListItem;\nvar styles = StyleSheet.create({});","map":{"version":3,"names":["React","useEffect","useState","Avatar","ListItem","defaultPicURL","collection","limit","onSnapshot","orderBy","query","db","ChatListItem","id","chatName","enterChat","lastMessage","setLastMessage","q","querySnapshots","messages","forEach","doc","push","data","console","log","uri","photoUrl","fontWeight","displayName","message","styles","StyleSheet","create"],"sources":["C:/Users/egor6/WebstormProjects/api_mini_lab_4/components/ChatListItem.js"],"sourcesContent":["import {StyleSheet, TouchableOpacity} from 'react-native'\r\nimport React, {useEffect, useState} from 'react'\r\nimport {Avatar, ListItem} from 'react-native-elements';\r\nimport {defaultPicURL} from '../utils';\r\nimport {collection, limit, onSnapshot, orderBy, query} from 'firebase/firestore';\r\nimport {db} from '../firebase';\r\n\r\n// Элемент списка чатов\r\n// В props принимается id чата, название и функцию-коллбэк обработки нажатия на этот элемент\r\nconst ChatListItem = ({ id, chatName, enterChat }) => {\r\n    const [lastMessage, setLastMessage] = useState({});\r\n\r\n    useEffect(() => {\r\n        const q = query(collection(db, \"chats\", id, \"messages\"),\r\n            orderBy(\"timestamp\", \"desc\"), limit(1));\r\n        return onSnapshot(q, (querySnapshots) => {\r\n            const messages = [];\r\n            querySnapshots.forEach((doc) => {\r\n                messages.push({\r\n                    id: doc.id,\r\n                    data: doc.data()\r\n                });\r\n            });\r\n            setLastMessage(messages[0]);\r\n            console.log(messages);\r\n        });\r\n    }, []);\r\n\r\n    return (\r\n        <TouchableOpacity>\r\n            <ListItem onPress={() => enterChat(id, chatName)} key={id} bottomDivider>\r\n                <Avatar rounded source={{\r\n                    uri: lastMessage?.data?.photoUrl || defaultPicURL //chatMessages?.[0]?.photoUrl ||\r\n                }}/>\r\n                <ListItem.Content>\r\n                    <ListItem.Title numberOfLines={1} style={{fontWeight: \"800\"}}>\r\n                        {chatName}\r\n                    </ListItem.Title>\r\n                    <ListItem.Subtitle numberOfLines={1} ellipsizeMode=\"tail\">\r\n                        {lastMessage?.data?.displayName} : {lastMessage?.data?.message}\r\n                    </ListItem.Subtitle>\r\n                </ListItem.Content>\r\n            </ListItem>\r\n        </TouchableOpacity>\r\n\r\n    )\r\n}\r\n\r\nexport default ChatListItem\r\n\r\nconst styles = StyleSheet.create({})"],"mappings":";;;AACA,OAAOA,KAAK,IAAGC,SAAS,EAAEC,QAAQ,QAAO,OAAO;AAChD,SAAQC,MAAM,EAAEC,QAAQ,QAAO,uBAAuB;AACtD,SAAQC,aAAa;AACrB,SAAQC,UAAU,EAAEC,KAAK,EAAEC,UAAU,EAAEC,OAAO,EAAEC,KAAK,QAAO,oBAAoB;AAChF,SAAQC,EAAE;;AAAqB;AAAA;AAI/B,IAAMC,YAAY,GAAG,SAAfA,YAAY,OAAoC;EAAA;EAAA,IAA9BC,EAAE,QAAFA,EAAE;IAAEC,QAAQ,QAARA,QAAQ;IAAEC,SAAS,QAATA,SAAS;EAC3C,gBAAsCb,QAAQ,CAAC,CAAC,CAAC,CAAC;IAAA;IAA3Cc,WAAW;IAAEC,cAAc;EAElChB,SAAS,CAAC,YAAM;IACZ,IAAMiB,CAAC,GAAGR,KAAK,CAACJ,UAAU,CAACK,EAAE,EAAE,OAAO,EAAEE,EAAE,EAAE,UAAU,CAAC,EACnDJ,OAAO,CAAC,WAAW,EAAE,MAAM,CAAC,EAAEF,KAAK,CAAC,CAAC,CAAC,CAAC;IAC3C,OAAOC,UAAU,CAACU,CAAC,EAAE,UAACC,cAAc,EAAK;MACrC,IAAMC,QAAQ,GAAG,EAAE;MACnBD,cAAc,CAACE,OAAO,CAAC,UAACC,GAAG,EAAK;QAC5BF,QAAQ,CAACG,IAAI,CAAC;UACVV,EAAE,EAAES,GAAG,CAACT,EAAE;UACVW,IAAI,EAAEF,GAAG,CAACE,IAAI;QAClB,CAAC,CAAC;MACN,CAAC,CAAC;MACFP,cAAc,CAACG,QAAQ,CAAC,CAAC,CAAC,CAAC;MAC3BK,OAAO,CAACC,GAAG,CAACN,QAAQ,CAAC;IACzB,CAAC,CAAC;EACN,CAAC,EAAE,EAAE,CAAC;EAEN,OACI,KAAC,gBAAgB;IAAA,UACb,MAAC,QAAQ;MAAC,OAAO,EAAE;QAAA,OAAML,SAAS,CAACF,EAAE,EAAEC,QAAQ,CAAC;MAAA,CAAC;MAAU,aAAa;MAAA,WACpE,KAAC,MAAM;QAAC,OAAO;QAAC,MAAM,EAAE;UACpBa,GAAG,EAAE,CAAAX,WAAW,yCAAXA,WAAW,CAAEQ,IAAI,qBAAjB,kBAAmBI,QAAQ,KAAIvB;QACxC;MAAE,EAAE,EACJ,MAAC,QAAQ,CAAC,OAAO;QAAA,WACb,KAAC,QAAQ,CAAC,KAAK;UAAC,aAAa,EAAE,CAAE;UAAC,KAAK,EAAE;YAACwB,UAAU,EAAE;UAAK,CAAE;UAAA,UACxDf;QAAQ,EACI,EACjB,MAAC,QAAQ,CAAC,QAAQ;UAAC,aAAa,EAAE,CAAE;UAAC,aAAa,EAAC,MAAM;UAAA,WACpDE,WAAW,0CAAXA,WAAW,CAAEQ,IAAI,qBAAjB,mBAAmBM,WAAW,SAAKd,WAAW,0CAAXA,WAAW,CAAEQ,IAAI,qBAAjB,mBAAmBO,OAAO;QAAA,EAC9C;MAAA,EACL;IAAA,GAXgClB,EAAE;EAY9C,EACI;AAG3B,CAAC;AAED,eAAeD,YAAY;AAE3B,IAAMoB,MAAM,GAAGC,UAAU,CAACC,MAAM,CAAC,CAAC,CAAC,CAAC"},"metadata":{},"sourceType":"module"}